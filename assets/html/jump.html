<div id="jump-page">
  <form method="GET" action="/jump" autocomplete="off">
    <input type="text" name="pattern" id="jump-pattern" class="focused" />
  </form>
  <ul id="jump-list">
    {pages}
  </ul>
</div>

<script>
  window.WIKI_PAGES = [];
  var first = true;
  document.querySelectorAll("#jump-list li a").forEach((el) => {
    if (first) {
      el.closest("li").classList.add("active");
      first = false;
    }
    window.WIKI_PAGES.push({
      name: el.innerText,
      path: el.href.split("/").slice(-1)[0],
    });
  });

  // jump-to-page js
  document.querySelector("#jump-pattern").addEventListener("keyup", (e) => {
    // down arrow
    if (e.keyCode == 40) {
      let el = document.querySelector("#jump-list .active");
      el.classList.remove("active");
      el.nextSibling.classList.add("active");
      return;
    }

    // up arrow
    if (e.keyCode == 38) {
      let el = document.querySelector("#jump-list .active");
      el.classList.remove("active");
      el.previousSibling.classList.add("active");
      return;
    }

    const fuse = new Fuse(window.WIKI_PAGES, { keys: ["name"] });
    const pattern = e.target.value;
    let list = document.querySelectorAll("#jump-list li");
    if (pattern == "") {
      list.forEach((el) => (el.style.display = ""));
    } else {
      let matches = fuse.search(pattern);
      list.forEach((el) => (el.style.display = "none"));
      for (var i = matches.length - 1; i >= 0; i--) {
        let match = matches[i];
        let el = document.querySelector("#jump-" + match.refIndex);
        let jumpList = document.querySelector("#jump-list");
        jumpList.removeChild(el);
        var active = document.querySelector(".active");
        if (active) active.classList.toggle("active");
        el.classList.add("active");
        jumpList.insertBefore(el, jumpList.childNodes[0]);
        el.style.display = "";
      }
    }
  });
</script>
